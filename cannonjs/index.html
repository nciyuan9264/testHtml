<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Babylon.js Physics Demo</title>
    <script src="../html/libs/babylon.js"></script>
    <!-- <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script> -->
    <!-- <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script> -->
    <!-- <script src="https://cdn.babylonjs.com/inspector/babylon.inspector.bundle.js"></script> -->
    <script src="../html/libs/babylon.gui.min.js"></script>
    <script src="https://cdn.babylonjs.com/cannon.js"></script>

    <style>
        canvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>
<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");
        var engine = new BABYLON.Engine(canvas, true);

        var createScene = function () {
            var scene = new BABYLON.Scene(engine);
            scene.clearColor = BABYLON.Color3.Purple();

            var camera = new BABYLON.ArcRotateCamera("Camera", 3 * Math.PI / 2, Math.PI / 2, 150, BABYLON.Vector3.Zero(), scene);
            camera.attachControl(canvas, true);

            var light1 = new BABYLON.DirectionalLight("light1", new BABYLON.Vector3(1, 1, 1), scene);
            var light2 = new BABYLON.HemisphericLight("light2", new BABYLON.Vector3(1, -3, 2), scene);

            light1.intensity = 0.5;

            // Pivot
            var greenBox = BABYLON.MeshBuilder.CreateBox("greenBox", { size: 6 }, scene);
            var greenMat = new BABYLON.StandardMaterial("green", scene);
            greenMat.diffuseColor = BABYLON.Color3.Green();
            greenBox.material = greenMat;

            //
            var box = BABYLON.MeshBuilder.CreateBox("Box", { size: 3 }, scene);
            box.position = new BABYLON.Vector3(-10, 0, 0);
            var blueMat = new BABYLON.StandardMaterial("blue", scene);
            blueMat.diffuseColor = new BABYLON.Color3.Blue();
            box.material = blueMat;

            // Physics
            scene.enablePhysics(new BABYLON.Vector3(0, 0, 0), new BABYLON.CannonJSPlugin());

            // Add Imposters
            box.physicsImpostor = new BABYLON.PhysicsImpostor(box, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 2 }, scene);
            greenBox.physicsImpostor = new BABYLON.PhysicsImpostor(greenBox, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 10 }, scene);


            // Add Joint
            var joint1 = new BABYLON.PhysicsJoint(BABYLON.PhysicsJoint.LockJoint, {});

            greenBox.physicsImpostor.addJoint(box.physicsImpostor, joint1);

            // Impulse Settings
            var impulseDirection = new BABYLON.Vector3(1, 0, 1);
            var impulseMagnitude = 5;
            var contactLocalRefPoint = new BABYLON.Vector3(0, 2, 0);

            var pulse = function () {
                box.physicsImpostor.applyImpulse(impulseDirection.scale(impulseMagnitude), box.getAbsolutePosition().add(contactLocalRefPoint));
            }

            // GUI

            var changeX = function (value) {
                impulseDirection.x = value;
            }

            var changeY = function (value) {
                impulseDirection.y = value;
            }

            var changeZ = function (value) {
                impulseDirection.z = value;
            }

            var magnitude = function (value) {
                impulseMagnitude = value;
            }

            var contactX = function (value) {
                contactLocalRefPoint.x = value;
            }

            var contactY = function (value) {
                contactLocalRefPoint.y = value;
            }

            var contactZ = function (value) {
                contactLocalRefPoint.z = value;
            }

            var displayDValue = function (value) {
                return Math.floor(value * 100) / 100;
            }

            var displayMValue = function (value) {
                return Math.floor(value);
            }


            var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

            var selectBox = new BABYLON.GUI.SelectionPanel("spi");
            selectBox.width = 0.25;
            selectBox.height = 0.8;
            selectBox.background = "#1388AF";
            selectBox.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            selectBox.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;

            advancedTexture.addControl(selectBox);

            var impulseMGroup = new BABYLON.GUI.SliderGroup("Impulse Magnitude", "S");
            impulseMGroup.addSlider("Value", magnitude, "units", 0, 100, 5, displayMValue);

            var impulseDGroup = new BABYLON.GUI.SliderGroup("Impulse Direction", "S");
            impulseDGroup.addSlider("X", changeX, "units", -1, 1, 1, displayDValue);
            impulseDGroup.addSlider("Y", changeY, "units", -1, 1, 0, displayDValue);
            impulseDGroup.addSlider("Z", changeZ, "units", -1, 1, 1, displayDValue);

            var contactGroup = new BABYLON.GUI.SliderGroup("Contact Position", "S");
            contactGroup.addSlider("X", contactX, "units", -2, 2, 0, displayDValue);
            contactGroup.addSlider("Y", contactY, "units", -2, 2, 2, displayDValue);
            contactGroup.addSlider("Z", contactZ, "units", -2, 2, 0, displayDValue);

            selectBox.addGroup(impulseMGroup);
            selectBox.addGroup(impulseDGroup);
            selectBox.addGroup(contactGroup);

            var button = BABYLON.GUI.Button.CreateSimpleButton("but", "Apply Impulse");
            button.width = 0.2;
            button.height = "40px";
            button.color = "white";
            button.background = "#1388AF";
            button.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
            button.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
            button.top = "-10px";

            button.onPointerClickObservable.add(pulse)
            advancedTexture.addControl(button);

            return scene;
        }

        var scene = createScene();

        engine.runRenderLoop(function () {
            scene.render();
        });

        window.addEventListener("resize", function () {
            engine.resize();
        });
    </script>
</body>
</html>
