<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    #backgroundCanvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }

    #foregroundCanvas {
      position: absolute;
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <canvas id="backgroundCanvas"></canvas>
  <canvas id="foregroundCanvas"></canvas>
</body>
<script>
  let bgCanvas = document.getElementById('backgroundCanvas');
  let bgWidth = bgCanvas.width = 1080;
  let bgHeight = bgCanvas.height = 800;
  let bgCtx = bgCanvas.getContext('2d');

  let fgCanvas = document.getElementById('foregroundCanvas');
  let fgWidth = fgCanvas.width = 1080;
  let fgHeight = fgCanvas.height = 800;
  let fgCtx = fgCanvas.getContext('2d');

  let radius = 80;
  let image = new Image();
  image.src = './background.jpeg';

  let mouseX = fgCanvas.width / 2;
  let mouseY = fgCanvas.height / 2;
  let lastTile = '1';
  let currentTile = '1';
  let lastTime = Date.now();

  fgCanvas.addEventListener('mousemove', function (event) {
    if (Date.now() - lastTime >= 16) {
      lastTime = Date.now();
      let rect = fgCanvas.getBoundingClientRect();
      mouseX = event.clientX - rect.left;
      mouseY = event.clientY - rect.top;
      drawForeground();
      if (lastTile !== currentTile) {
        clearRect('1234', true);
        lastTile = currentTile;
      }
    }
  });

  function drawBackground() {
    bgCtx.clearRect(0, 0, bgWidth, bgHeight);
    bgCtx.drawImage(image, 0, 0);
    fgCtx.fillStyle = "#ffffff";
    fgCtx.fillRect(0, 0, fgWidth, fgHeight);
  }

  function clearRect(tileIndex, remember) {
    if (!remember) {
      currentTile = tileIndex;
    }
    let firstPos = tileIndex.slice(0, 1);
    let x = firstPos === '1' || firstPos === '3' ? 0 : fgWidth / 2;
    let y = firstPos === '1' || firstPos === '2' ? 0 : fgHeight / 2;
    let width = fgWidth / 2;
    let height = fgHeight / 2;
    if (tileIndex.length > 2) {
      width = fgWidth;
      height = fgHeight;
    } else if (tileIndex.length === 2) {
      if (tileIndex === '12' || tileIndex === '34') {
        width = fgWidth;
        height = fgHeight / 2;
      } else if (tileIndex === '13' || tileIndex === '24') {
        width = fgWidth / 2;
        height = fgHeight;
      }
    }
    fgCtx.clearRect(x, y, width, height);
    fgCtx.restore();
    fgCtx.save();
    fgCtx.beginPath();
    fgCtx.rect(x, y, width, height);
    fgCtx.clip();
    fgCtx.fillRect(x, y, width, height);
  }

  function drawForeground() {
    fgCtx.globalCompositeOperation = "source-over";
    fgCtx.fillStyle = "#ffffff";
    if (mouseX <= fgWidth / 2 && mouseY < fgHeight / 2) {
      if (mouseX > fgWidth / 2 - radius && mouseY > fgHeight / 2 - radius) {
        clearRect('1234');
      } else if (mouseX > fgWidth / 2 - radius) {
        clearRect('12');
      } else if (mouseY > fgHeight / 2 - radius) {
        clearRect('13');
      } else {
        clearRect('1');
      }
    } else if (mouseX > fgWidth / 2 && mouseY < fgHeight / 2) {
      if (mouseX < fgWidth / 2 + radius && mouseY > fgHeight / 2 - radius) {
        clearRect('1234');
      } else if (mouseX < fgWidth / 2 + radius) {
        clearRect('12');
      } else if (mouseY > fgHeight / 2 - radius) {
        clearRect('24');
      } else {
        clearRect('2');
      }
    } else if (mouseX <= fgWidth / 2 && mouseY >= fgHeight / 2) {
      if (mouseX > fgWidth / 2 - radius && mouseY < fgHeight / 2 + radius) {
        clearRect('1234');
      } else if (mouseX > fgWidth / 2 - radius) {
        clearRect('34');
      } else if (mouseY < fgHeight / 2 + radius) {
        clearRect('13');
      } else {
        clearRect('3');
      }
    } else if (mouseX >= fgWidth / 2 && mouseY >= fgHeight / 2) {
      if (mouseX < fgWidth / 2 + radius && mouseY < fgHeight / 2 + radius) {
        clearRect('1234');
      } else if (mouseX < fgWidth / 2 + radius) {
        clearRect('34');
      } else if (mouseY < fgHeight / 2 + radius) {
        clearRect('24');
      } else {
        clearRect('4');
      }
    }

    fgCtx.globalCompositeOperation = 'destination-out';
    fgCtx.beginPath();
    fgCtx.arc(mouseX, mouseY, radius - 5, 0, Math.PI * 2, false);
    fgCtx.closePath();
    fgCtx.fillStyle = "rgba(0, 0, 0, 1)";
    fgCtx.fill();
  }

  image.onload = function () {
    drawBackground();
  };

  fgCanvas.addEventListener('wheel', (e) => {
    if (e.deltaY < 0) {
      radius = Math.min(++radius, 120);
    } else if (e.deltaY > 0) {
      radius = Math.max(--radius, 50);
    }
  });
</script>
</html>
